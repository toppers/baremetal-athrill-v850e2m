# これは何？

V850命令セットでC言語のポインタ操作を理解します。

## ポインタとは？

ポインタは、メモリアドレスを格納する変数です。メモリアドレスとは、メモリ上のデータの位置を示す番号です。ポインタを使うことで、メモリ上のデータに直接アクセスできます。

### ポインタの宣言

ポインタを宣言する例：

```c
int *global_value_pointer;
```

`int`型のポインタ`global_value_pointer`を宣言しています。`*`はポインタを示す記号です。

### ポインタの初期化

ポインタを初期化する例：

```c
int global_value;
int *global_value_pointer;
global_value_pointer = &global_value;
```

変数`global_value`のアドレスを`global_value_pointer`に代入します。`&`はアドレス演算子です。

### ポインタを使ったメモリ書き込み

```c
*global_value_pointer = 0x87654321;
```

ポインタが指すアドレスに、値`0x87654321`を格納します。

### ポインタを使ったメモリ参照

```c
int value = *global_value_pointer;
```

ポインタが指すアドレスから値を取得し、変数`value`に代入します。

---

## V850命令セット

|命令|説明|
|---|---|
|mov|レジスタ間のデータ転送|
|ld.w|メモリからワードデータを読み込む|
|st.w|ワードデータをメモリに書き込む|
|add|加算|
|movea|レジスタ間のアドレス転送|

---

## メモリアドレス

|アドレス|内容|
|---|---|
|0x5ff7404|global_value_pointer|
|0x5ff7408|global_value|

athrillでの確認結果：

```
p global_value
global_value = 0 (int:4) @ 0x5ff7408(0x0)

p global_value_pointer
global_value_pointer = (int *: 4 ) 0x0  @ 0x5ff7404(0x0)
```

---

### ポインタの初期化のアセンブラ命令

#### Cコードとアセンブラ命令の対応

| Cコード                              | アセンブラ命令                      |
|--------------------------------------|-------------------------------------|
| global_value_pointer = &global_value;| a06: mov 0x5ff7404, r10            |
|                                      | a0c: mov 0x5ff7408, r11            |
|                                      | a12: st.w r11, 0[r10]              |

#### athrillコマンドの実行結果

| コマンド             | 結果                           |
|----------------------|--------------------------------|
| b 0xa06              | break 0xa06                   |
| c                    | INFO: INITIALIZE POINTER       |
|                      | global_value = 0x12345678      |
| cpu                  | R10: 0x0 (Return Value)        |
|                      | R11: 0xc0a                    |
| n (mov 0x5ff7404, r10)| R10: 0x5ff7404                |
|                      | R11: 0xc0a                    |
| n (mov 0x5ff7408, r11)| R11: 0x5ff7408                |
| n (st.w r11, 0[r10])  | global_value_pointer = 0x5ff7408|

#### レジスタの値変化

| 命令               | R10の値        | R11の値       |
|--------------------|----------------|---------------|
| 初期値             | 0x0            | 0xc0a         |
| mov 0x5ff7404, r10 | 0x5ff7404      | 0xc0a         |
| mov 0x5ff7408, r11 | 0x5ff7404      | 0x5ff7408     |
| st.w r11, 0[r10]   | 0x5ff7404      | 0x5ff7408     |

---

### ポインタを使ったメモリ書き込みのアセンブラ命令

#### Cコードとアセンブラ命令の対応

| Cコード                              | アセンブラ命令                      |
|--------------------------------------|-------------------------------------|
| *global_value_pointer = 0x87654321;  | a82: mov 0x5ff7404, r10            |
|                                      | a88: ld.w 0[r10], r10              |
|                                      | a8c: mov 0x87654321, r11           |
|                                      | a92: st.w r11, 0[r10]              |

#### athrillコマンドの実行結果

| コマンド             | 結果                           |
|----------------------|--------------------------------|
| b 0xa82              | break 0xa82                   |
| c                    | INFO: INITIALIZE POINTER       |
|                      | global_value = 0x12345678      |
| cpu                  | PC: 0xa82                     |
|                      | R10: 0x0                      |
|                      | R11: 0xc24                    |
| n (mov 0x5ff7404, r10)| R10: 0x5ff7404                |
|                      | PC: 0xa88                     |
| n (ld.w 0[r10], r10) | R10: 0x5ff7408                |
|                      | PC: 0xa8c                     |
| n (mov 0x87654321, r11)| R11: 0x87654321              |
| n (st.w r11, 0[r10]) | global_value = 0x87654321      |

#### レジスタの値変化

| 命令               | R10の値        | R11の値       |
|--------------------|----------------|---------------|
| 初期値             | 0x0            | 0xc24         |
| mov 0x5ff7404, r10 | 0x5ff7404      | 0xc24         |
| ld.w 0[r10], r10   | 0x5ff7408      | 0xc24         |
| mov 0x87654321, r11| 0x5ff7408      | 0x87654321    |
| st.w r11, 0[r10]   | 0x5ff7408      | 0x87654321    |

---

### ポインタを使ったメモリ参照のアセンブラ命令

#### Cコードとアセンブラ命令の対応

| Cコード                              | アセンブラ命令                      |
|--------------------------------------|-------------------------------------|
| int value = *global_value_pointer;   | ac6: mov 0x5ff7404, r10            |
|                                      | acc: ld.w 0[r10], r10              |
|                                      | ad0: ld.w 0[r10], r10              |
|                                      | ad4: st.w r10, 0[r29]              |

#### athrillコマンドの実行結果

| コマンド             | 結果                           |
|----------------------|--------------------------------|
| b 0xac6              | break 0xac6                   |
| c                    | INFO: READ POINTER            |
| cpu                  | PC: 0xac6                     |
|                      | R10: 0x0                      |
|                      | R11: 0xc39                    |
| n (mov 0x5ff7404, r10)| R10: 0x5ff7404                |
|                      | PC: 0xacc                     |
| n (ld.w 0[r10], r10) | R10: 0x5ff7408                |
|                      | PC: 0xad0                     |
| n (ld.w 0[r10], r10) | R10: 0x87654321               |
|                      | PC: 0xad4                     |
| n (st.w r10, 0[r29]) | value = 0x87654321            |

#### レジスタの値変化

| 命令               | R10の値        | R11の値       |
|--------------------|----------------|---------------|
| 初期値             | 0x0            | 0xc39         |
| mov 0x5ff7404, r10 | 0x5ff7404      | 0xc39         |
| ld.w 0[r10], r10   | 0x5ff7408      | 0xc39         |
| ld.w 0[r10], r10   | 0x87654321     | 0xc39         |
| st.w r10, 0[r29]   | 0x87654321