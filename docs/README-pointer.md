# これは何？

V850命令セットでC言語のポインタ操作を理解します。

## ポインタとは？

ポインタとは、メモリアドレスを格納するための変数です。メモリアドレスとは、コンピュータのメモリ上の位置を示す番号です。ポインタは、メモリ上のデータにアクセスするために使用されます。

### ポインタの宣言

ポインタを宣言するには、次のようにします。

```c
int *global_value_pointer;
```

この例では、`int`型のポインタ`global_value_pointer`を宣言しています。`*`はポインタを示す演算子です。

### ポインタの初期化

ポインタを初期化するには、次のようにします。

```c
int global_value;
int *global_value_pointer;
global_value_pointer = &global_value;
```

この例では、`int`型の変数`global_value`を宣言し、そのアドレスを`global_value_pointer`に代入しています。`&`はアドレス演算子です。

### ポインタを使ったメモリ書き込み

ポインタを使ってメモリ上のデータを書き換えることができます。

```c
*global_value_pointer = 0x87654321;
```

この例では、`global_value_pointer`が指すメモリ上のデータを`0x87654321`に書き換えています。

### ポインタを使ったメモリ参照

ポインタを参照するには、次のようにします。

```c
int value = *global_value_pointer;
```

この例では、`global_value_pointer`が指すメモリ上のデータを`value`に代入しています。



## ポインタ操作で使うV850命令セット

|命令|説明|
|---|---|
|mov|レジスタ間のデータ転送|
|ld.w|メモリからワードデータを読み込む|
|st.w|ワードデータをメモリに書き込む|
|add|加算|
|movea|レジスタ間のアドレス転送|

## アドレス

|アドレス|内容|
|---|---|
|0x5ff7404|global_value_pointer|
|0x5ff7408|global_value|

athrillでの確認結果：

```
p global_value
global_value = 0 (int:4) @ 0x5ff7408(0x0)
[DBG>p global_value_pointer
global_value_pointer = (int *: 4 ) 0x0  @ 0x5ff7404(0x0)
```

### ポインタの初期化のアセンブラ命令

# Cコードとアセンブラ命令の対応

| **Cコード**                              | **アセンブラ命令**                                |
|------------------------------------------|--------------------------------------------------|
| `global_value_pointer = &global_value;`  | `a06:  mov  0x5ff7404, r10`         |
|                                          | `a0c:  mov  0x5ff7408, r11`         |
|                                          | `a12:  st.w  r11, 0[r10]`          |

### athrillコマンドの実行結果

| **コマンド**                  | **結果**                                                                 |
|-------------------------------|--------------------------------------------------------------------------|
| `b 0xa06`                     | `break 0xa06`                                                          |
| `c`                           | `INFO: INITIALIZE POINTER`<br>`global_value = 0x12345678`               |
| `cpu`                         | `R10: 0x0 (Return Value)`<br>`R11: 0xc0a`                              |
| `n` (`mov 0x5ff7404, r10`)    | `R10: 0x5ff7404 (global_value_pointer)`<br>`R11: 0xc0a`                 |
| `n` (`mov 0x5ff7408, r11`)    | `R10: 0x5ff7404 (global_value_pointer)`<br>`R11: 0x5ff7408 (global_value)`|
| `n` (`st.w r11, 0[r10]`)      | `global_value_pointer = 0x5ff7408`                                      |


### レジスタの値変化

| **命令**                   | **R10の値**             | **R11の値**             |
|----------------------------|-------------------------|-------------------------|
| 初期値                     | `0x0`                  | `0xc0a`                |
| `mov 0x5ff7404, r10`       | `0x5ff7404` (ポインタ) | `0xc0a`                |
| `mov 0x5ff7408, r11`       | `0x5ff7404` (ポインタ) | `0x5ff7408` (値)       |
| `st.w r11, 0[r10]`         | `0x5ff7404` (ポインタ) | `0x5ff7408` (値格納済) |

### ポインタを使ったメモリ書き込みのアセンブラ命令

# Cコードとアセンブラ命令の対応
| **Cコード**                              | **アセンブラ命令**                                |
|------------------------------------------|--------------------------------------------------|
| `*global_value_pointer = 0x87654321;`    | `a82:  mov	0x5ff7404, r10`         |
|                                          | `a88:  ld.w	0[r10], r10`         |
|                                          | `a8c:  mov	0x87654321, r11`         |
|                                          | `a92:  st.w	r11, 0[r10]`          |


### athrillコマンドの実行結果

| **コマンド**                  | **結果**                                                                 |
|-------------------------------|--------------------------------------------------------------------------|
| `b 0xa82`                     | `break 0xa82`                                                          |
| `c`                           | `INFO: INITIALIZE POINTER`<br>`global_value = 0x12345678`               |
|                               | `global_value address = 0x05FF7408`                                    |
| `cpu`                         | `PC: 0xa82`<br>`R10: 0x0`<br>`R11: 0xc24`                              |
| `n` (`mov 0x5ff7404, r10`)    | `PC: 0xa88`<br>`R10: 0x5ff7404 (global_value_pointer)`                  |
| `n` (`ld.w 0[r10], r10`)      | `PC: 0xa8c`<br>`R10: 0x5ff7408 (global_value)`                         |
| `n` (`mov 0x87654321, r11`)   | `PC: 0xa92`<br>`R11: 0x87654321`                                       |
| `n` (`st.w r11, 0[r10]`)      | `PC: 0xa96`<br>`global_value: 0x87654321`                              |


### レジスタの値変化

| **命令**                   | **R10の値**             | **R11の値**             |
|----------------------------|-------------------------|-------------------------|
| 初期値                     | `0x0`                  | `0xc0a`                |
| `mov 0x5ff7404, r10`       | `0x5ff7404`            | `0xc0a`                |
| `ld.w 0[r10], r10`         | `0x5ff7408`            | `0xc0a`                |
| `mov 0x87654321, r11`      | `0x5ff7408`            | `0x87654321`           |
| `st.w r11, 0[r10]`         | `0x5ff7408`            | `0x87654321`           |

### ポインタを使ったメモリ参照のアセンブラ命令

TODO

